<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√≠blia Desktop - OCR</title>
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">üìò B√≠blia Desktop</a>
    </div>
</nav>

<div class="container py-4">
    <h2>Enviar imagem do cronograma</h2>
    <p>Envie uma imagem com as leituras (ex: "01/11 - Jo√£o 1"). O sistema far√° OCR e mostrar√° o texto extra√≠do abaixo.</p>

    <div class="card mb-3">
        <div class="card-body">
            <form id="uploadForm">
                <div class="mb-3">
                    <label for="file" class="form-label">Selecionar imagem</label>
                    <input class="form-control" type="file" id="file" name="file" accept="image/*" required>
                </div>
                <button class="btn btn-primary" id="uploadBtn" type="submit">Enviar imagem</button>
            </form>
        </div>
    </div>

    <div id="resultado" class="mt-3" style="display:none;">
        <div class="alert alert-success">Imagem enviada e lida com sucesso!</div>
        <div class="card">
            <div class="card-header">Texto extra√≠do</div>
            <div class="card-body">
                <pre id="textoExtraido" style="white-space: pre-wrap;"></pre>
            </div>
        </div>
    </div>

    <div id="erro" class="alert alert-danger mt-3" style="display:none;"></div>
</div>

<script src="/static/bootstrap/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementById("uploadForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const fileInput = document.getElementById("file");
    const btn = document.getElementById("uploadBtn");
    const resultado = document.getElementById("resultado");
    const erro = document.getElementById("erro");
    const textoExtraido = document.getElementById("textoExtraido");

    resultado.style.display = "none";
    erro.style.display = "none";

    if (!fileInput.files.length) {
        alert("Selecione uma imagem primeiro!");
        return;
    }

    btn.disabled = true;
    btn.innerText = "Enviando...";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    try {
        const response = await fetch("/upload", {
            method: "POST",
            body: formData
        });

        if (!response.ok) {
            throw new Error("Erro ao processar imagem (HTTP " + response.status + ")");
        }

        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");
        const pre = doc.querySelector("pre");

        if (pre) {
            textoExtraido.textContent = pre.textContent.trim();
            resultado.style.display = "block";
        } else {
            throw new Error("N√£o foi poss√≠vel extrair o texto do retorno do servidor.");
        }
    } catch (err) {
        erro.textContent = err.message;
        erro.style.display = "block";
    } finally {
        btn.disabled = false;
        btn.innerText = "Enviar imagem";
    }
});
</script>
</body>
</html>
